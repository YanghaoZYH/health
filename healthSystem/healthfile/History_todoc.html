<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../css/heathfile.css" />
	</head>

	<body>
		<header class="mui-bar mui-bar-nav public-color">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<div class="chose">
				<span id="">
		    	患者:
		    </span>
				<span class="mui-select">
		    	<select id="relative" class="chose_man">
				</select>
			</span>
			</div>
		</header>
		<div id="content" class="mui-content">
			<p class="box">--在线就诊记录--</p>
			<div class="online_history">
				<ul class="mui-table-view mui-card">
				        <li class="mui-table-view-cell">
				           <span style="margin-left: 137px;">暂无</span>
				        </li>
				    </ul>
				<!--<ul class="mui-table-view mui-card">
					<li class="mui-table-view-cell">
						<span id="">
				           	就诊医生：
				           </span>
						<span id="">
				           	张医生
				           </span>
						<div class="mui-pull-right" style="width: 50%;">
							<span id="">
					           	所属医院：
					           </span>
							<span id="">
					           	中心医院
				           	   </span>
						</div>

					</li>
					<li class="mui-table-view-cell">

						<span id="">
					           	就诊科室：
					           </span>
						<span id="">
					           	耳鼻喉科
					           </span>

						<div class="mui-pull-right" style="width: 50%; ">
							<span id="">
					           	就诊信息：
					           </span>
							<span id="">
					           	鼻炎
					           </span>
						</div>

					</li>
					<li class="mui-table-view-cell">

						<span id="">
					           	医生诊断建议：
					           </span>
						<span id="">
					           	所患过敏性鼻炎....
					           </span>

					</li>
					<li class="mui-table-view-cell">

						<span id="">
					           	处方信息：
					           </span>
						<span id="">
					           	阿司匹林一片  清开灵颗粒1盒
					           </span>

					</li>
					<li class="mui-table-view-cell">
						<span id="">
							就诊日期：
				           </span>
						<span id="">
				           	2017-04-01 
				           </span>
					</li>
					<li class="mui-table-view-cell">
						<p>
							<button type="button" class="mui-btn mui-btn-success mui-btn-outlined mui-pull-right history_button">
															去复诊
								</button>
							<button id="detail_online" type="button" class="mui-btn mui-btn-success mui-btn-outlined mui-pull-right history_button detail_online">
															查看详情
								</button>
						</p>

					</li>
				</ul>-->
			</div>
			<p class="box">--线下就诊记录--</p>
			<div id="outline_history" class="outline_history">

			</div>
			<div class="submit" id="add_outline">
				<span class="mui-btn mui-btn-success ">
					增加线下就诊记录
					</span>
			</div>
		</div>
		<script src="../js/mui.min.js"></script>
		<script src="../js/common.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			mui.init();
			mui.plusReady(function() {
				var outline_add = "outline_add";
				var outline_detail = "outline_detail";
			   	plus.webview.close(outline_add,"none");
			   	plus.webview.close(outline_detail,"none");
				if(islogin()) {
					var user_phone = plus.storage.getItem('user_phone');
					//获取用户的亲友姓名
					var relative = document.getElementById("relative");
					var item = '<option value="0">本人</option>';
					mui.get('http://' + serverName + '/health/management/Application/index.php/Connector/Health/getHisRelaName', {
						user_phone: user_phone
					}, function(data) {
						for(var j = 0; j < data.length; j++) {
							item = item + '<option value="' + data[j].relative_id + '">' + data[j].relative_name + '</option>';
						}
						relative.innerHTML = item;
					}, 'json');
					//默认获取本人的历史就诊记录
					var outline = document.getElementById("outline_history");
					var item2 = '';
					mui.get('http://' + serverName + '/health/management/Application/index.php/Connector/Health/getHisVis', {
						relative_id: 0,
						user_phone: user_phone
					}, function(data) {
						for(var i = 0; i < data.length; i++) {
							item2 = item2 + '<ul class="mui-table-view mui-card"><li class="mui-table-view-cell "><span id="">就诊医院：</span><span id="">' + data[i].seecase_hos +
								'</span></li><li class="mui-table-view-cell "><span id="">就诊医生：</span><span id="">' + data[i].seecase_doc +
								'</span></li><li class="mui-table-view-cell "><span id="">就诊科室：</span><span id="">' + data[i].seecase_depa +
								'</span><div class="mui-pull-right" style="width: 50%; "><span id="">医生诊断：</span><span id="">' + data[i].seecase_info +
								'</span></div></li><li class="mui-table-view-cell "><span id="">医生建议：</span><span id="">' + data[i].seecase_sgs +
								'</span></li><li class="mui-table-view-cell "><span id="">处方信息：</span><span id="">' + data[i].page_info +
								'</span></li><li class="mui-table-view-cell "><span id="">就诊时间：</span><span id="">' + data[i].seecase_time +
								' </span></li><li class="mui-table-view-cell"><p><button seecaseID="' + data[i].seecase_id + '" id="detail_outline" type="button" class="mui-btn mui-btn-success mui-btn-outlined mui-pull-right history_button detail_outline">查看详情</button></p></li></ul>';
						}
						outline.innerHTML = item2;
					}, 'json');
					//获取指定亲友的历史就诊记录
					relative.addEventListener('change', function(event) {
						relative_id = this.value;
						var add_outline = document.getElementById("add_outline");
						
						var item3 = '';
						var item4 = '';
						mui.get('http://' + serverName + '/health/management/Application/index.php/Connector/Health/getHisVis', {
							relative_id: relative_id,
							user_phone: user_phone
						}, function(data) {
							if(data == null) {
								item3 = item3 + '<ul class="mui-table-view mui-card"><li class="mui-table-view-cell"><span style="margin-left: 137px;">暂无</span></li></ul>';
								outline.innerHTML = item3;
							} else {
								for(var i = 0; i < data.length; i++) {
									item3 = item3 + '<ul class="mui-table-view mui-card"><li class="mui-table-view-cell "><span id="">就诊医院：</span><span id="">' + data[i].seecase_hos +
										'</span></li><li class="mui-table-view-cell "><span id="">就诊医生：</span><span id="">' + data[i].seecase_doc +
										'</span></li><li class="mui-table-view-cell "><span id="">就诊科室：</span><span id="">' + data[i].seecase_depa +
										'</span><div class="mui-pull-right" style="width: 50%; "><span id="">医生诊断：</span><span id="">' + data[i].seecase_info +
										'</span></div></li><li class="mui-table-view-cell "><span id="">医生建议：</span><span id="">' + data[i].seecase_sgs +
										'</span></li><li class="mui-table-view-cell "><span id="">处方信息：</span><span id="">' + data[i].page_info +
										'</span></li><li class="mui-table-view-cell "><span id="">就诊时间：</span><span id="">' + data[i].seecase_time +
										' </span></li><li class="mui-table-view-cell"><p><button seecaseID="' + data[i].seecase_id + '" id="detail_outline" type="button" class="mui-btn mui-btn-success mui-btn-outlined mui-pull-right history_button detail_outline">查看详情</button></p></li></ul>';
								}
								item4 = item4 + '<div class="submit" id="add_outline1"><span class="mui-btn mui-btn-success ">增加线下就诊记录</span></div>';
								outline.innerHTML = item3;
								add_outline.innerHTML = item4;
								//切换亲友时重新添加一个添加按钮用于传递当前亲友ID
								var add_outline1 = document.getElementById("add_outline1");
								add_outline1.addEventListener('tap', function(event) {
								mui.openWindow({
									url: 'outline_add.html',
									id: 'outline_add',
									extras:{
										relative_id:relative_id
									},
									show: {
										aniShow: 'pop-in'},
									waiting: {
									autoShow: false
									}
									});
								}, false);
								var detailPage = null;
								mui(".outline_history").on('tap', '.detail_outline', function(event) {
									var seecaseID = this.getAttribute('seecaseID');
									mui.openWindow({
										id: 'outline_detail',
										url:'outline_detail.html',
										extras:{
											seecaseID: seecaseID,
											relative_id: relative_id
										},
										show: {
											aniShow: 'pop-in'
										}
									});
								});
							}
						},'json');
					});
				} else {
					plus.ui.toast("请先登录");
					var self = plus.webview.currentWebview();
					var w = plus.webview.create('/login/login.html');
					w.show("pop-in");
					self.close();
				}
				var relative_id = 0;
				var detailPage = null;
				mui(".outline_history").on('tap', '.detail_outline', function(event) {
					var seecaseID = this.getAttribute('seecaseID');
					mui.openWindow({
						id: 'outline_detail',
						url:'outline_detail.html',
						extras:{
							seecaseID: seecaseID,
							relative_id: relative_id
						},
						show: {
							aniShow: 'pop-in'
						}
					});
				});
				
				//console.log(relative_id);
				add_outline.addEventListener('tap', function(event) {
					mui.openWindow({
						url: 'outline_add.html',
						id: 'outline_add',
						extras:{
							relative_id:relative_id
						},
						show: {
							aniShow: 'pop-in'
						},
						waiting: {
							autoShow: false
						}
					});
				}, false);
			});
		</script>
	</body>

</html>